/* effects.css - アニメーション・演出・エフェクト */

/* 斬撃 */
.slash-line {
    position: absolute; top: 50%; left: 50%; width: 150px; height: 4px;
    background: linear-gradient(90deg, transparent, #fff 50%, transparent);
    box-shadow: 0 0 10px #ff4757; z-index: 1000; transform: translate(-50%, -50%) rotate(-45deg);
    animation: enemySlash 0.15s ease-out forwards;
}
@keyframes enemySlash { 0% { transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); opacity: 0; } 50% { transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); opacity: 1; } 100% { transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); opacity: 0; } }

/* 魔法陣 */
.magic-circle {
    position: absolute; top: 50%; left: 50%; width: 50px; height: 50px;
    border: 5px solid #70abdb; border-radius: 50%; transform: translate(-50%, -50%);
    animation: magicAnim 0.5s ease-out forwards;
}
@keyframes magicAnim { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(4); opacity: 0; } }

/* ダメージポップアップ */
.damage-popup { position: absolute; top: 50%; left: 50%; font-size: 28px; font-weight: bold; text-shadow: 2px 2px 0 #000; z-index: 100; animation: damageUp 0.8s ease-out forwards; }
@keyframes damageUp { 0% { transform: translate(-50%, -20%) scale(0.5); opacity: 0; } 20% { transform: translate(-50%, -80%) scale(1.2); opacity: 1; } 100% { transform: translate(-50%, -150%) scale(1); opacity: 0; } }

/* 味方強調 */
.active-member { transform: translateY(-15px) !important; border-color: #f1c40f !important; box-shadow: 0 0 10px #f1c40f; }
.screen-flash { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 9999; pointer-events: none; }
.heal-light { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(46, 204, 113, 0.3); border-radius: 5px; animation: healFlash 0.6s ease-out forwards; }
@keyframes healFlash { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

/* --- キングスライム分裂用演出 --- */

/* 浮遊アニメを一時停止させるため !important を追加 */
.splitting { 
    animation: shake-split 0.8s ease-in-out forwards !important; 
}

@keyframes shake-split {
    0% { transform: translate(0, 0) scale(1.1); filter: brightness(1); }
    25% { transform: translate(-10px, 0) scale(1.2); filter: brightness(1.5); }
    50% { transform: translate(10px, 0) scale(1.3); filter: brightness(2); }
    75% { transform: translate(-10px, 0) scale(1.4); filter: brightness(2.5); }
    100% { transform: translate(0, 0) scale(1.5); filter: brightness(3); opacity: 0; }
}

.enemy-unit.split-pos-left { 
    transform: scale(1.0) translateX(-50px); 
}
.enemy-unit.split-pos-right { 
    transform: scale(1.0) translateX(50px); 
}

.enemy-unit.appear-left { 
    animation: split-left 1.0s ease-out forwards !important; 
}
.enemy-unit.appear-right { 
    animation: split-right 1.0s ease-out forwards !important; 
}


@keyframes split-left {
    0% { transform: scale(1.1) translateX(100px); opacity: 0; }
    10% { transform: scale(1.01) translateX(90px); opacity: 0.1; }
    20% { transform: scale(1.02) translateX(80px); opacity: 0.2; }
    30% { transform: scale(1.03) translateX(70px); opacity: 0.3; }
    40% { transform: scale(1.04) translateX(60px); opacity: 0.4; }
    50% { transform: scale(1.05) translateX(50px); opacity: 0.5; }
    60% { transform: scale(1.06) translateX(40px); opacity: 0.6; }
    70% { transform: scale(1.07) translateX(30px); opacity: 0.7; }
    80% { transform: scale(1.08) translateX(20px); opacity: 0.8; }
    90% { transform: scale(1.09) translateX(10px); opacity: 0.9; }
    100% { transform: scale(1.0) translateX(0); opacity: 1; }
}
@keyframes split-right {
    0% { transform: scale(1.1) translateX(-100px); opacity: 0; }
    10% { transform: scale(1.01) translateX(-90px); opacity: 0.1; }
    20% { transform: scale(1.02) translateX(-80px); opacity: 0.2; }
    30% { transform: scale(1.03) translateX(-70px); opacity: 0.3; }
    40% { transform: scale(1.04) translateX(-60px); opacity: 0.4; }
    50% { transform: scale(1.05) translateX(-50px); opacity: 0.5; }
    60% { transform: scale(1.06) translateX(-40px); opacity: 0.6; }
    70% { transform: scale(1.07) translateX(-30px); opacity: 0.7; }
    80% { transform: scale(1.08) translateX(-20px); opacity: 0.8; }
    90% { transform: scale(1.09) translateX(-10px); opacity: 0.9; }
    100% { transform: scale(1.0) translateX(0); opacity: 1; }
}
.appear-left { animation: split-left 0.5s ease-out forwards; }
.appear-right { animation: split-right 0.5s ease-out forwards; }


/* ボス巨大化・画像調整 */
.king-size .enemy-img { width: 200px; filter: drop-shadow(0 0 15px rgba(16, 0, 192, 0.83)); }
.king-size .enemy-hp-container { width: 180px; }
.king-size .enemy-label { font-size: 20px; color: #f1c40f; }

.enemy-unit.dragon-size { transform: translateY(-20px); z-index: 5; }
.dragon-size .enemy-img { width: 100%; max-width: 300px; height: auto; filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.8)) drop-shadow(0 0 15px rgba(0, 0, 0, 0.8)) drop-shadow(0 0 30px rgba(0, 210, 255, 0.6)) brightness(1.1); animation: dragonFloating 4s ease-in-out infinite; }
.dragon-size .enemy-hp-container { width: 90%; max-width: 320px; height: 12px; border: 2px solid #000000; background: #000; box-shadow: 0 0 10px rgba(0, 210, 255, 0.5); margin-left: auto; margin-right: auto; }
.dragon-size .enemy-label { font-size: min(26px, 6vw); font-weight: 900; color: #e0ffff; text-shadow: 0 0 10px #0055ff, 0 0 20px #00d2ff; margin-bottom: 8px; }
.dragon-size .enemy-status-container { top: -30px; }
@keyframes dragonFloating { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-15px) scale(1.02); } }

/* 敵の影・浮遊 */
.enemy-unit::after { content: ""; display: block; position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); width: 85%; height: 12px; background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.7) 0%, transparent 70%); z-index: -1; border-radius: 50%; pointer-events: none; }
.enemy-unit:has(.enemy-img[src*="cragen"])::after, .enemy-unit:has(.enemy-img[src*="dragon"])::after, .king-size::after, .dragon-size::after { bottom: -4px; width: 80%; opacity: 0.6; animation: shadow-scale 3s ease-in-out infinite; }
@keyframes shadow-scale { 0%, 100% { transform: translateX(-50%) scale(1); } 50% { transform: translateX(-50%) scale(0.9); } }
.enemy-img { width: 120px; height: auto; animation: cragenFloating 3s ease-in-out infinite; cursor: pointer; }
@keyframes cragenFloating { 0%, 100% { transform: translateY(0) scale(1, 1); } 50% { transform: translateY(-10px) scale(1.05, 0.95); } }

/* 画面振動 */
.screen-shake { animation: shake-action 0.1s infinite; }
@keyframes shake-action { 0% { transform: translate(0, 0); } 25% { transform: translate(8px, 8px); } 50% { transform: translate(-8px, -8px); } 75% { transform: translate(8px, -8px); } 100% { transform: translate(0, 0); } }

/* 特殊魔法エフェクト */
.meteor-rock { position: fixed; top: 0; left: 50%; width: 80px; height: 80px; background: radial-gradient(circle, #ff4500, #3a1c02 70%); border-radius: 50%; box-shadow: 0 0 30px #ff4500; z-index: 1000; pointer-events: none; transform: translate(-50%, -100px); transition: transform 0.4s ease-in, opacity 0.2s; }
.meteor-explosion { position: absolute; top: 50%; left: 50%; width: 150px; height: 150px; background: radial-gradient(circle, #fff 10%, #ff4500 50%, transparent 70%); transform: translate(-50%, -50%) scale(0); border-radius: 50%; z-index: 1001; animation: explosion-anim 0.4s ease-out forwards; }
@keyframes explosion-anim { 0% { transform: translate(-50%, -50%) scale(0); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } }
.fireball { position: fixed; width: 40px; height: 40px; background: radial-gradient(circle, #fff 0%, #ff4500 50%, #ff8c00 100%); border-radius: 50%; box-shadow: 0 0 20px #ff4500, 0 0 10px #ff8c00; z-index: 1000; pointer-events: none; transition: transform 0.3s ease-in, opacity 0.1s; }
.fire-burn { position: absolute; bottom: 10%; left: 50%; width: 100px; height: 153px; background: radial-gradient(ellipse at bottom, #fff 0%, #ff4500 40%, #ff8c00 70%, transparent 90%); filter: blur(2px); transform: translate(-50%, 0) scale(0); z-index: 1001; mix-blend-mode: screen; animation: fire-pillar-anim 0.6s ease-out forwards; }
@keyframes fire-pillar-anim { 0% { transform: translate(-50%, 20px) scale(0.2, 2); opacity: 0; } 30% { transform: translate(-50%, -40px) scale(1.5, 1.2); opacity: 1; } 100% { transform: translate(-50%, -100px) scale(0.8, 1.5); opacity: 0; } }
.ice-pillar { position: absolute; bottom: 10%; left: 50%; width: 100px; height: 153px; background: radial-gradient(ellipse at bottom, #fff 0%, #00d2ff 40%, #0055ff 70%, transparent 90%); filter: blur(2px); transform: translate(-50%, 0) scale(0); z-index: 1001; mix-blend-mode: screen; animation: ice-pillar-anim 0.8s ease-out forwards; }
@keyframes ice-pillar-anim { 0% { transform: translate(-50%, 20px) scale(0.2, 0); opacity: 0; } 20% { transform: translate(-50%, 0) scale(1.2, 1.2); opacity: 1; } 100% { transform: translate(-50%, -50px) scale(0.8, 1.5); opacity: 0; } }

/* 咆哮・オーラ・合体 */
@keyframes roar-shake { 0% { transform: translate(0, 0) scale(1); } 10% { transform: translate(-5px, -5px) scale(1.1); } 50% { transform: translate(-3px, 3px) scale(1.1); } 100% { transform: translate(0, 0) scale(1); } }
.roaring { animation: roar-shake 0.8s ease-out; filter: drop-shadow(0 0 10px red); z-index: 100; }
.shadow-aura .enemy-img { filter: brightness(0.95) contrast(1.0) drop-shadow(0 0 10px #4b0082) drop-shadow(0 0 20px #8e44ad); }
.dark-atmosphere::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, rgba(20, 0, 40, 0.2) 30%, rgba(10, 0, 20, 0.8) 100%); pointer-events: none; z-index: 1; mix-blend-mode: multiply; }
.fusion-core { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); width: 100px; height: 100px; background: black; border-radius: 50%; box-shadow: 0 0 20px #4b0082, 0 0 60px #8e44ad, inset 0 0 30px #fff; z-index: 100; animation: core-pulse 2.5s ease-in-out forwards; }
@keyframes core-pulse { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0.5; } 20% { transform: translate(-50%, -50%) scale(1.0); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(20); opacity: 0; } }
.being-absorbed { transition: all 1.0s ease-in !important; transform: scale(0) translateY(-50px) !important; filter: brightness(0) blur(5px) !important; opacity: 0 !important; }
.dark-flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; animation: flash-invert 0.5s ease-out forwards; pointer-events: none; }
@keyframes flash-invert { 0% { background: black; opacity: 1; } 100% { background: white; opacity: 0; } }
/* 1. ゆっくり不気味な横揺れ */
@keyframes ominous-sway {
    0%   { transform: translateX(0); }
    25%  { transform: translateX(-8px); } /* 左へ */
    75%  { transform: translateX(8px); }  /* 右へ */
    100% { transform: translateX(0); }
}
.sway-slow {
    /* 1秒かけてゆっくり揺れるのを繰り返す */
    animation: ominous-sway 1.0s infinite ease-in-out !important;
}

/* 2. 激しい白点滅（ピシャーン！） */
@keyframes flash-blink {
    0%   { filter: brightness(1) opacity(1); }
    50%  { filter: brightness(10) opacity(0.8) drop-shadow(0 0 30px white); } /* 真っ白に発光 */
    100% { filter: brightness(1) opacity(1); }
}
.flash-rapid {
    /* 0.1秒間隔でピカピカさせる */
    animation: flash-blink 0.1s infinite !important;
}

/* === 永続する猛吹雪エフェクト === */
#blizzard-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 1; /* 敵より手前、UIより奥 */
    
    /* 斜めの白い線を走らせて風を表現 */
    background: 
        repeating-linear-gradient(120deg, transparent, transparent 10px, rgba(255, 255, 255, 0.1) 10px, rgba(255, 255, 255, 0.2) 20px),
        repeating-linear-gradient(60deg, transparent, transparent 20px, rgba(255, 255, 255, 0.05) 20px, rgba(255, 255, 255, 0.1) 40px);
    background-size: 200% 200%;
    
    /* 全体を青白くして寒そうにする */
    background-color: rgba(180, 220, 255, 0.15);
    
    opacity: 0; transition: opacity 3.0s ease-in; /* ゆっくり発生させる */
    animation: blizzard-storm 0.3s linear infinite; /* 高速で動かす */
}

@keyframes blizzard-storm {
    0%   { background-position: 0% 0%; }
    100% { background-position: -50% 50%; }
}

/* =========================================
   ★吹雪エフェクト
   ========================================= */

/* 雪の粒（共通設定） */
.snow-layer {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%; /* 親要素に合わせて広げる */
    background-repeat: repeat;
    animation-timing-function: linear; /* 一定速度 */
    animation-iteration-count: infinite;
    /* 合成モードを変えて、重なった時に白飛びするように輝かせる（お好みで削除可） */
    mix-blend-mode: screen;
}

/* --- レイヤー1: 奥（細かい粉雪がびっしり） --- */
.snow-layer.back {
    background-image: 
        radial-gradient(circle 2px at 5% 5%,  rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 15% 25%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 25% 10%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 35% 40%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 45% 20%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 55% 50%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 65% 15%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 75% 45%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 85% 20%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 95% 50%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 10% 80%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 30% 70%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 50% 90%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 70% 60%, rgba(255,255,255,0.8) 0%, transparent 60%),
        radial-gradient(circle 2px at 90% 80%, rgba(255,255,255,0.8) 0%, transparent 60%);
    
    background-size: 200px 200px;
    opacity: 0.7;
    animation-name: blizzard-loop-200;
    animation-duration: 5s;
}

/* --- レイヤー2: 中（普通の雪が大量に） --- */
.snow-layer.middle {
    background-image: 
        radial-gradient(circle 8px at 10% 20%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 6px at 20% 80%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 8px at 30% 10%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 7px at 40% 60%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 8px at 50% 30%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 6px at 60% 90%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 8px at 70% 20%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 7px at 80% 70%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 8px at 90% 40%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 6px at 15% 50%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 8px at 35% 85%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 7px at 55% 15%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 8px at 75% 55%, rgba(255,255,255,0.9) 0%, transparent 50%),
        radial-gradient(circle 6px at 95% 15%, rgba(255,255,255,0.9) 0%, transparent 50%);
    
    background-size: 300px 300px;
    opacity: 0.8;
    animation-name: blizzard-loop-300;
    animation-duration: 2.5s;
}

/* --- レイヤー3: 手前（視界を遮る巨大な塊） --- */
.snow-layer.front {
    background-image: 
        radial-gradient(circle 30px at 5% 15%, white 0%, transparent 70%),
        radial-gradient(circle 25px at 15% 75%, white 0%, transparent 70%),
        radial-gradient(circle 40px at 25% 25%, white 0%, transparent 70%),
        radial-gradient(circle 30px at 35% 85%, white 0%, transparent 70%),
        radial-gradient(circle 50px at 50% 50%, white 0%, transparent 70%),
        radial-gradient(circle 30px at 65% 10%, white 0%, transparent 70%),
        radial-gradient(circle 40px at 75% 65%, white 0%, transparent 70%),
        radial-gradient(circle 25px at 85% 30%, white 0%, transparent 70%),
        radial-gradient(circle 30px at 95% 90%, white 0%, transparent 70%),
        radial-gradient(circle 35px at 45% 5%, white 0%, transparent 70%),
        radial-gradient(circle 25px at 60% 95%, white 0%, transparent 70%);
    
    background-size: 400px 400px;
    opacity: 1.0;
    animation-name: blizzard-loop-400;
    animation-duration: 0.8s;
}


/* =========================================
   ★重要：完璧なループのためのアニメーション定義
   「移動距離」を「background-sizeの倍数」にする
   ========================================= */

/* 200pxサイズ用：右に2区画(400px)、下に1区画(200px)動かす */
@keyframes blizzard-loop-200 {
    from { background-position: 0 0; }
    to   { background-position: 400px 200px; } 
}

/* 300pxサイズ用：右に3区画(900px)、下に1区画(300px)動かす */
@keyframes blizzard-loop-300 {
    from { background-position: 0 0; }
    /* 横の移動量を増やすほど「横殴り」感が強く */
    to   { background-position: 900px 300px; } 
}

/* 400pxサイズ用：右に4区画(1600px)、下に1区画(400px)動かす */
@keyframes blizzard-loop-400 {
    from { background-position: 0 0; }
    /* 手前はものすごい速度で横切る */
    to   { background-position: 1600px 400px; } 
}

/* クリックターゲット候補 */
.target-candidate { cursor: pointer; filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.5)); transition: all 0.2s; }
.target-candidate:hover { transform: scale(1.03); filter: drop-shadow(0 0 6px rgba(255, 215, 0, 0.7)); z-index: 10; }


/* === 全滅＆復活イベント用（修正版2） === */

/* 1. 全滅ダメージ（画面真っ赤） */
.flash-red {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    /* 中心は透明、外側に向かって赤くなる（ヴィネット効果） */
    background: radial-gradient(circle, transparent 40%, rgba(255, 0, 0, 0.5) 100%);
    z-index: 99999; pointer-events: none;
    mix-blend-mode: hard-light;
    opacity: 0; animation: flash-red-anim 0.5s ease-out;
}
@keyframes flash-red-anim {
    0% { opacity: 1; } 100% { opacity: 0; }
}

/* 2. 奇跡の復活（黄金の光） */
.flash-gold {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    
    /* 【修正】外側を transparent（透明）にして、ゲーム画面が見えるようにする */
    background: radial-gradient(circle, rgba(255, 255, 200, 0.8) 0%, rgba(255, 215, 0, 0.3) 40%, transparent 80%);
    
    z-index: 99999; pointer-events: none;
    mix-blend-mode: screen; /* 光を重ねるモード */
    
    opacity: 0; animation: flash-gold-anim 3.0s ease-in-out;
}
@keyframes flash-gold-anim {
    0% { opacity: 0; }
    20% { opacity: 1; } /* ふわっと光る */
    80% { opacity: 1; }
    100% { opacity: 0; }
}

/* 3. 神猫ざぼち降臨 */
.zabochi-appear {
    position: fixed !important;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    max-width: 60%; 
    max-height: 60%;
    z-index: 100000;
    pointer-events: none;
    filter: drop-shadow(0 0 20px gold);
    opacity: 0;
    animation: zabochi-anim 3.0s ease-in-out forwards;
}
@keyframes zabochi-anim {
    0%   { opacity: 0; transform: translate(-50%, -40%) scale(0.5); }
    20%  { opacity: 1; transform: translate(-50%, -50%) scale(1.0); }
    80%  { opacity: 1; transform: translate(-50%, -50%) scale(1.0); }
    100% { opacity: 0; transform: translate(-50%, -60%) scale(1.2); }
}